<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hanxi">
<meta name="dcterms.date" content="2025-11-20">
<meta name="description" content="A classroom taste test about language, bias, and confidence.">

<title>I Tried to Outsource My Taste Buds to an LLM – Prompts, Dreams, and Me</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-1db3f541d99483cdc7a0d9cf38862b2c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Prompts, Dreams, and Me</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/hanxi-guo"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/hanxi-guo-765289301/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">I Tried to Outsource My Taste Buds to an LLM</h1>
                  <div>
        <div class="description">
          A classroom taste test about language, bias, and confidence.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">LLMs</div>
                <div class="quarto-category">Human–AI Interaction</div>
                <div class="quarto-category">Class</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Hanxi </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 20, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>In class today, we didn’t write code. We didn’t discuss neural network architectures. We drank soda.</p>
<p>Specifically, we conducted a blind taste test of the two giants of the carbonated world: Coke and Pepsi. But there was a twist. The goal wasn’t just to see if we could taste the difference; the goal was to see if we could translate that sensory experience into text, feed it to a Large Language Model (LLM), and have the AI deduce which drink was which.</p>
<p>It was a test of Human Qualia vs.&nbsp;Machine Logic. How do you convert a biological, subjective signal (taste/smell/mouthfeel) into a digital, objective string of text (a Prompt) that allows a non-sentient neural network to perform a classification task? Could I describe the physical sensation of “fizz” well enough that a disembodied brain in a server farm could “taste” it?</p>
<p>The “Sommelier” Phase I took this job seriously. I channeled my inner wine snob. <strong>I didn’t just drink; I analyzed. I swirled. I pondered.</strong></p>
<blockquote class="blockquote">
<p>The following experiment was conducted using Gemini 2.5 for educational purposes, focusing on prompt engineering and sensory translation. The content generated represents probabilistic outputs based on training data and does not reflect personal endorsements of Coca-Cola or PepsiCo.</p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="cover.png" class="img-fluid figure-img"></p>
<figcaption>Image created by gemini</figcaption>
</figure>
</div>
<section id="experiment" class="level1">
<h1>Experiment</h1>
<p><strong>Before prompting, my guess is that the Cola 1 is Coca-Cola and Cola 2 is Pepsi</strong></p>
<section id="prompt" class="level2">
<h2 class="anchored" data-anchor-id="prompt"><strong>Prompt</strong>:</h2>
<p><strong>Color:</strong> Both look almost the same, though Cola 1 has slightly more bubbles.<br>
<strong>Smell:</strong> Cola 1 has a sweeter, more noticeable aroma. Cola 2’s scent is very faint—almost hard to pick up.<br>
<strong>Taste:</strong> Cola 1 tastes fuller and richer, while Cola 2 feels lighter and less sweet given these descirbtion which one you think it’s pepsi ond which one is coke</p>
</section>
<section id="response" class="level2">
<h2 class="anchored" data-anchor-id="response"><strong>Response</strong>:</h2>
<section id="version-1" class="level3">
<h3 class="anchored" data-anchor-id="version-1">version 1:</h3>
<p>Google: Gemini 2.5 Flash Based on your descriptions, here’s my guess:</p>
<p>Cola 1: Coca-Cola The “fuller and richer” taste, combined with a “sweeter, more noticeable aroma,” strongly aligns with how many people describe Coca-Cola’s classic, more complex, and robust flavor profile. Cola 2: Pepsi The “lighter” feel and “less sweet” taste (in comparison to Cola 1), along with a “very faint” scent, often matches descriptions of Pepsi, which is sometimes perceived as having a lighter body and a simpler, less pronounced flavor than Coke.</p>
</section>
<section id="version-2" class="level3">
<h3 class="anchored" data-anchor-id="version-2">version 2:</h3>
<p>Google: Gemini 2.5 Flash Based on your descriptions, here’s my assessment:</p>
<p>Cola 1 is likely Pepsi. Smell: “Sweeter, more noticeable aroma” aligns with Pepsi, which is often perceived as having a more pronounced and sweeter initial scent. Taste: “Fuller and richer” also fits Pepsi, which many people describe as having a bolder, sweeter, and sometimes slightly heavier or more syrupy taste compared to Coke. Cola 2 is likely Coke. Smell: “Very faint—almost hard to pick up” suggests a less overtly sweet or strong aroma, which can be true for Coke compared to Pepsi’s initial sweetness. Taste: “Lighter and less sweet” is a classic description for Coke. It’s often seen as having a crisper, less immediately sweet, and slightly more complex flavor profile with a lighter mouthfeel than Pepsi. So, my guess is:</p>
<p>Cola 1 = Pepsi Cola 2 = Coke</p>
</section>
<section id="version-3-add-more-details" class="level3">
<h3 class="anchored" data-anchor-id="version-3-add-more-details">version 3 (add more details):</h3>
<p>Alright, let’s conduct a more detailed analysis and inference:</p>
<p>Based on your description, my conclusion remains:</p>
<p><strong>Cola 1 is very likely Pepsi</strong> <strong>Cola 2 is very likely Coca-Cola</strong></p>
<p>Below are more detailed observations and reasoning:</p>
<hr>
<p>Cola 1 (Inferred to be Pepsi)</p>
<p>Color:</p>
<p><strong>Your description:</strong> “Both look almost the same, though Cola 1 has slightly more bubbles.”</p>
<p><strong>Detailed analysis:</strong> Although color is usually difficult to distinguish, the detail of “slightly more bubbles” is noteworthy. Pepsi is often described as having more active, larger, or faster-dissipating carbonation, especially right after being poured. Its carbonation can feel more immediate and aggressive, which differs slightly from Coca-Cola’s typically finer and more persistent bubbles.</p>
<p>Smell:</p>
<p><strong>Your description:</strong> “Cola 1 has a sweeter, more noticeable aroma.”</p>
<p><strong>Detailed analysis:</strong> This is one of the key clues pointing to Pepsi. Pepsi is commonly perceived as having a more direct and expressive sweetness in its aroma—closer to a pure syrupy sweetness, often accompanied by noticeable citrus notes (especially lemon or lime). Its aroma tends to be very apparent upon smelling, immediately signaling a high level of sweetness.</p>
<p>Taste:</p>
<p><strong>Your description:</strong> “Cola 1 tastes fuller and richer…”</p>
<p><strong>Detailed analysis:</strong> This is almost a signature description of Pepsi.</p>
<ul>
<li><strong>“Fuller”</strong> refers to the heavier mouthfeel and coating sensation in the mouth. Pepsi’s higher perceived sweetness and slightly higher sugar content make it feel denser and more syrup-like.</li>
<li><strong>“Richer”</strong> indicates a more direct and intense flavor profile. Many people find Pepsi’s sweetness to be the dominant note, with stronger citrus or fruity undertones and less emphasis on spice complexity. The sweetness is straightforward and immediate, quickly filling the mouth and leaving a lingering, sometimes slightly cloying aftertaste.</li>
</ul>
<hr>
<p>Cola 2 (Inferred to be Coca-Cola)</p>
<p>Color:</p>
<p><strong>Your description:</strong> “Both look almost the same…”</p>
<p><strong>Detailed analysis:</strong> This aligns with reality, as the two colas are visually very difficult to distinguish. Coca-Cola’s carbonation is often described as finer and longer-lasting, contributing to a cleaner and more refreshing carbonation experience rather than Pepsi’s more forceful initial fizz.</p>
<p>Smell:</p>
<p><strong>Your description:</strong> “Cola 2’s scent is very faint—almost hard to pick up.”</p>
<p><strong>Detailed analysis:</strong> This is an important clue pointing toward Coca-Cola. Coca-Cola’s aroma is generally more restrained and complex. Rather than releasing an obvious sugary scent, it tends to carry subtler notes of spices (such as cinnamon and vanilla) and caramel. These aromas don’t immediately rush out but require closer attention, giving a more refined and understated impression.</p>
<p>Taste:</p>
<p><strong>Your description:</strong> “…while Cola 2 feels lighter and less sweet.”</p>
<p><strong>Detailed analysis:</strong> This perfectly matches Coca-Cola’s classic flavor profile.</p>
<ul>
<li><strong>“Lighter”</strong> refers to a cleaner, more refreshing mouthfeel. Compared to Pepsi, Coca-Cola usually has slightly lower perceived sweetness, with its acidity (from phosphoric acid) balancing the sugar more effectively. This creates a “cleaner” overall taste with less heaviness.</li>
<li><strong>“Less sweet”</strong> contrasts clearly with Pepsi’s upfront sweetness. Coca-Cola’s sweetness is more balanced and layered—it’s not just sugar, but a blend of sweetness with distinctive spices (such as vanilla, cinnamon, and cardamom) and a caramel base. This complexity allows Coca-Cola to feel flavorful without being overtly sweet, and its aftertaste is typically crisper and less lingering.</li>
</ul>
<hr>
<p>Conclusion:</p>
<p>Overall, your description perfectly captures the classic sensory differences between Pepsi and Coca-Cola. Pepsi stands out for its bold sweetness, fuller mouthfeel, and more energetic carbonation, while Coca-Cola is known for its subtle aroma, balanced sweetness, refreshing lightness, and complex flavor structure.</p>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="scene.png" class="img-fluid figure-img"></p>
<figcaption>Image photoed by me</figcaption>
</figure>
</div>
</section>
</section>
</section>
<section id="result" class="level1">
<h1>Result</h1>
<p>Finally, it turned out that the Cola 1 is Pepsi and Cola 2 is Coca-cola, where I guess wrong and the llm’s guess is right！This result is fascinating and slightly embarrassing. I drank the soda. I tasted the sugar. I felt the bubbles. And yet, I got it completely wrong. Meanwhile, a silicon-based model residing in a data center, which has never tasted a drop of liquid in its existence, correctly identified the drinks based solely on my words.</p>
<p><strong>But why Did the AI Win?</strong></p>
<p>Firstly, it’s worth noting that the first version of the AI (Version 1) got it wrong, seemingly agreeing with my subconscious bias. But when I pushed for a “detailed analysis” (Version 3), the model stopped hallucinating and started reasoning. It may cross-referenced “faint aroma” with Coca-Cola’s complex spice profile in its database and realized: “Wait, this user is describing Coke, they just don’t know it.”</p>
<p>Besides, Human decision making is inevitably colored by personal preference and emotional reasoning. Since I’ve spent most of my life drinking Coke, my brain ran a flawed logic script: <em>‘I like this taste, therefore it must be Coke.’</em></p>
<p>The LLM, however, carries no such baggage. It lacks experiences, feelings, or brand loyalty. Instead, it purely focuses on the statistical similarity between my description word vectors and its training data. While I was busy being biased, the model simply calculated the highest probability score and that objective math turned out to be the correct answer.</p>
<p>Thus, I didn’t feel upset about failing to beat the LLM in this test. Instead, it was a relieving moment. It showed me that AI isn’t just a tool for generating text; it can be a tool for debugging human perception. I provided the raw sensory input, and the AI provided the objective logic that I lacked. Together, we found the truth.</p>
<p>Yet, that subjectivity is the point. My ability to be biased, to have a ‘favorite,’ and to feel the bubbles. That is the messy, authentic core of being human that no LLM can replicate.</p>
<p><strong>As for my career as a soda sommelier? I think I’ll stick to Prompt Engineering.</strong></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/hanxi-guo\.github\.io\/comm4190_F25_Using_LLMs_Blog\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>