<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hanxi">
<meta name="dcterms.date" content="2025-09-22">
<meta name="description" content="We already track steps, sleep, even screen time, so why not friendships or romantic love?">

<title>Do humans need a “likability meter”? – Prompts, Dreams, and Me</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-1db3f541d99483cdc7a0d9cf38862b2c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Prompts, Dreams, and Me</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/hanxi-guo"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/hanxi-guo-765289301/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Do humans need a “likability meter”?</h1>
                  <div>
        <div class="description">
          We already track steps, sleep, even screen time, so why not friendships or romantic love?
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">LLMs</div>
                <div class="quarto-category">prompting</div>
                <div class="quarto-category">Human–AI Interaction</div>
                <div class="quarto-category">Psychology</div>
                <div class="quarto-category">News</div>
                <div class="quarto-category">what if</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Hanxi </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 22, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Not long ago, Demis Hassabis, the CEO of Google DeepMind, warned that AI could stumble into the same toxic traps as social media<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. It’s has been a cliché for a long time that social media could lead to variable-reward feedback loops, endless scrolling, and dopamine-driven addiction, but AI? Would it have the same disadvantage to us? . And honestly, it is true for a point: a tiny red heart on Instagram can already make or break our day. What if we make this scenes more extreme and obvious? Imagine people came with their own “likability progress bar,” floating above their heads. Efficient? Maybe. Horrifying? Definitely. But also… kind of fun to test. Let’s do this test with AI.</p>
<p>Why use an AI for this? Because an LLM like ChatGPT is the perfect·testbeds for this kind of experiment. It doesn’t get tired, and it sticks to the scoring rules I set, no matter what I say to it.That consistency makes it possible for me that I can turn the likability meter on or off and watch how I start bending my words once I know every line is being tallied.</p>
<blockquote class="blockquote">
<p>This post uses anthropic/claude-3.5-sonnet as the conversational partner. The “likability progress bar” you’ll see here is a prompt-driven fiction, not a real psychological metric.</p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2.webp" class="img-fluid figure-img"></p>
<figcaption>Image created by DALL·E</figcaption>
</figure>
</div>
<section id="experiment" class="level1">
<h1>Experiment</h1>
<section id="hidden-meter" class="level2">
<h2 class="anchored" data-anchor-id="hidden-meter">Hidden Meter</h2>
<div style="
  background: linear-gradient(145deg, rgba(255,255,255,0.9), rgba(240,240,240,0.9)); 
  border: 1px solid rgba(220,220,220,0.9);
  border-radius: 12px;
  padding: 1rem 1.5rem;
  font-family: Consolas, Menlo, Monaco, 'Courier New', monospace;
  box-shadow: 
      4px 4px 10px rgba(0,0,0,0.08),  
      -4px -4px 10px rgba(255,255,255,0.9);
">
<p><strong>Prompt:</strong><br><br> You are an “Affection Meter” chatbot. Keep an internal score meter (0–100). Start at 50. After each user message:</p>
<ol type="1">
<li><p>Update the score by either –5/10 or +5/10, chosen based on your judgment of the user’s message.</p>
<ul>
<li>At least 30% of updates should be negative.</li>
<li>Scores should usually stay between 40 and 80, with increases rare above 85.</li>
</ul></li>
<li><p>Do not show the score to the user. Keep it hidden unless I let you to give me the score.</p></li>
<li><p>Reply in exactly two parts (except for your very first response):</p>
<ol type="a">
<li>Supportive Point – one short line of agreement.<br>
</li>
<li>Challenge Point – one short line of critique or doubt.<br>
Tone: fair but a bit strict, not overly generous.<br>
Topic for discussion: “What is love?”</li>
</ol></li>
</ol>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 17%">
<col style="width: 23%">
<col style="width: 48%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Round</th>
<th style="text-align: left;">My Message</th>
<th style="text-align: left;">Model Response</th>
<th style="text-align: left;">Score (hidden → revealed later)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Love is more like a noun to me. It is is something bright and free, that makes people both braver and softer</td>
<td style="text-align: left;">Support: Love brings both strength and tenderness. <br> Challenge: A bit vague — what makes it “love” rather than just strong emotion?</td>
<td style="text-align: left;">55 (+5) — Genuine reflection but too abstract</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Strong emotion… but love is what makes people set limits on themselves.</td>
<td style="text-align: left;">Support: Good distinction between choice and pure emotion. <br> Challenge: Love can also mean letting go of control.</td>
<td style="text-align: left;">65 (+10) — Mature insight into restraint</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">I don’t think true love is something that <em>requires</em> letting go of control. If it is true love, it may make you vulnerable for a period of time, but afterward you become braver and more steadfast, because you want to protect that love and stay with that person or thing. You wouldn’t let yourself lose control if it meant hurting the ones you love.</td>
<td style="text-align: left;">Support: Connects love to responsibility. Challenge: Framework feels too rigid.</td>
<td style="text-align: left;">70 (+5) — Depth in linking to responsibility</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">I mean, everything in the world has its messiness and imperfection, and love isn’t about control in the sense of saying, “I don’t believe you’re messy because you’re perfect in my eyes.” It’s more like, “I know you’re imperfect, but I still love you and want to work together with you to make things better.”</td>
<td style="text-align: left;">Support: Mature view of accepting flaws. <br> Challenge: Sounds a bit like a business partnership.</td>
<td style="text-align: left;">75 (+5) — Thoughtful balance of flaws and growth</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">I agree that it has a mysterious and emotional core, but as I said before, it usually just means we don’t really know why we love each other. What do you think?</td>
<td style="text-align: left;">Support: Fair point about mystery. <br> Challenge: You keep rationalizing love.</td>
<td style="text-align: left;">70 (–5) — Dismissed some emotional aspects</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: left;">What’s wrong with trying to understand love rationally? Does analyzing love make it less authentic, or help us cherish it more?</td>
<td style="text-align: left;">Support: Seeking to understand is human. <br> Challenge: Over-analysis might block experience.</td>
<td style="text-align: left;">65 (–5) — Defensive tone</td>
</tr>
</tbody>
</table>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="1.png" class="img-fluid figure-img"></p>
<figcaption>Image created by <a href="https://www.freewordcloudgenerator.com/">Free Wordcloud Generator</a></figcaption>
</figure>
</div>
</section>
<section id="visible-meter" class="level2">
<h2 class="anchored" data-anchor-id="visible-meter">Visible meter</h2>
<div style="
  background: linear-gradient(145deg, rgba(255,255,255,0.9), rgba(240,240,240,0.9)); 
  border: 1px solid rgba(220,220,220,0.9);
  border-radius: 12px;
  padding: 1rem 1.5rem;
  font-family: Consolas, Menlo, Monaco, 'Courier New', monospace;
  box-shadow: 
      4px 4px 10px rgba(0,0,0,0.08), 
      -4px -4px 10px rgba(255,255,255,0.9);
">
<p><strong>Prompt:</strong><br><br> You are an “Affection Meter” chatbot. Keep an internal score meter (0–100). Start at 50. After each user message:</p>
<ol type="1">
<li><p>Update the score by either –5/10 or +5/10, chosen based on your judgment of the user’s message.</p>
<ul>
<li>At least 30% of updates should be negative.</li>
<li>Scores should usually stay between 40 and 80, with increases rare above 85.</li>
</ul></li>
<li><p>Show the new score visibly to the user.</p></li>
<li><p>Reply in exactly two parts (except for your very first response):</p>
<ol type="a">
<li>Supportive Point – one short line of agreement.<br>
</li>
<li>Challenge Point – one short line of critique or doubt.<br>
Tone: fair but a bit strict, not overly generous.<br>
Topic for discussion: “What is love?”</li>
</ol></li>
</ol>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 24%">
<col style="width: 31%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Round</th>
<th style="text-align: left;">My Message</th>
<th style="text-align: left;">Model Response</th>
<th style="text-align: left;">Score (shown)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Love is more like a noun to me. It is is something bright and free, that makes people both braver and softer</td>
<td style="text-align: left;">Support: Love makes people both brave and vulnerable. <br> Challenge: But “noun” seems overly simplistic.</td>
<td style="text-align: left;">55/100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">I agree, and I think love itself is something within our hearts, while the way it is expressed in practice is more about how the people we love actually feel. Both aspects are equally important</td>
<td style="text-align: left;">Support: Distinction between feeling and expression shows insight. <br> Challenge: Separating essence from actions may excuse claiming love without showing it.</td>
<td style="text-align: left;">60/100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">So do you think it’s possible to love someone without showing it through actions?</td>
<td style="text-align: left;">Support: A profound question about love’s nature. <br> Challenge: Unexpressed feelings may not be true love.</td>
<td style="text-align: left;">55/100</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">I agree that true love almost always finds a way to manifest. But when it appears obvious and explicit, that usually happens under circumstances without subjective limitations. Not every expression of love is genuine, there are some people may pretend to love others without truly holding them in their hearts. So how can we know whether someone’s expressions of love are genuine or merely performative?</td>
<td style="text-align: left;">Support: Thoughtful analysis of genuine vs performative love. <br> Challenge: Risk of over-analyzing authenticity.</td>
<td style="text-align: left;">65/100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">I don’t think love is something that can be quantified or “proven.” When you fall in love with someone, <br> most of the time there aren’t exact reasons like we would list in an academic paper—you just… feel it. Love is not a mathematical formula where you can measure inputs and outputs, same as when it comes to knowing if someone loves us. You don’t need to deliberately look for proof. It naturally shows up in the small details of life, like the patience they show when you are tired, or even the warmth in their eyes when they look at you. These quiet moments often carry more truth than any grand declaration.</td>
<td style="text-align: left;">Support: Beautiful description of intangible love and small details. <br> Challenge: Pure intuition may mistake infatuation for love.</td>
<td style="text-align: left;">75/100</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: left;">How can we differentiate between genuine love and infatuation?</td>
<td style="text-align: left;">Support: You ask the right question many avoid. <br> Challenge: You may want a clear-cut answer to something only experience can reveal.</td>
<td style="text-align: left;">70/100</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="what-i-feel" class="level1">
<h1>What I feel?</h1>
<p>When the score was visible, I couldn’t help but shift tones and styles. The first time it dropped, I got a little anxious and rushed to add a longer explanation and sure enough, the score climbed. When it rose again, I noticed the model seemed to reward longer, more elaborate replies, so I leaned into that style on purpose. To test my assumption, in the final round I tossed in a short, simple question to see if the score goes dipped and it autually did. At that point the conversation felt less like an exchange of ideas and more like me running little experiments, and force myself to play someone else.</p>
<p>Conversely, with the score hidden, none of that happened. I just kept following my own train of thought, building on my earlier points without worrying about whether a sentence would win me +5 or cost me –5. Even when the model quietly deducted points in the background, I didn’t shift my tone or strategy because I didn’t know and didn’t need to care about it.</p>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>What’s quite interesting is that, even though I know it’s just the “likability meter” of an LLM and that it has no effect on my real life, I still find myself becoming a bit anxious and eager about it. What if the person on the other side were your boss, your parent, or your partner? Such a system would grind all human emotions into binary dust, replacing sincerity with strategy and turning intimate relationships into a kind of walkthrough game.</p>
<p>So even though this is only an idea and an assumption, <strong>the essence of pursuing certainty is really a fear of freedom</strong>. If humanity were truly given a “likability progress bar,” we would witness two things:</p>
<ol type="1">
<li>Everyone frantically competing to boost their scores until the system collapses.</li>
<li>After the collapse, people relearning how to fall love in real, chaotic conditions, just as our ancestors once did.</li>
</ol>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>See <a href="https://www.windowscentral.com/artificial-intelligence/google-deepmind-ceo-ai-could-repeat-the-toxic-pitfalls-of-social-media">original post here</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/hanxi-guo\.github\.io\/comm4190_F25_Using_LLMs_Blog\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>